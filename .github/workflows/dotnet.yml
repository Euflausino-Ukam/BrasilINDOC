name: Ci

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup .NET 10 SDK
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: 10.0.x

      - name: Debug - show dotnet info and sdks
        run: |
          dotnet --info
          dotnet --list-sdks

      - name: Run tests (project discovery)
        # tenta descobrir projetos de teste e rodar cada um separadamente
        run: |
          # se quiser rodar um csproj específico substitua o find abaixo
          echo "Procurando projetos de teste..."
          mapfile -t tests < <(find . -type f -name "*Tests*.csproj" -o -name "*.Tests.csproj" -o -name "*Test*.csproj")
          if [ ${#tests[@]} -eq 0 ]; then
            echo "Nenhum projeto de teste encontrado por padrão — rodando dotnet test na solução."
            dotnet test --verbosity normal
            exit $?
          fi
          for proj in "${tests[@]}"; do
            echo "Executando testes em: $proj"
            dotnet test "$proj" --verbosity normal
          done
